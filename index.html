<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <meta name="description" content="FA Taxi - Betrouwbaar en voordelig taxivervoer in Nederland. Boek eenvoudig online.">
  <title>FA Taxi - Taxi Boeken</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/styles.css">
  <!-- Externe scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    /* Responsive base */
    body { padding: 0.5rem; }
    .container { max-width: 95vw; margin: 1rem auto; padding: 1rem; }
    input, select, textarea, button { width: 100% !important; box-sizing: border-box; }
    @media (max-width: 600px) {
      label, input, button, select, textarea { font-size: 0.9rem !important; }
      button, input { padding: 0.8rem !important; }
    }
    /* --- BASIS STYLING --- */
    body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #232526 0%, #191919 50%, #232526 100%);
  color: #fff;
  padding: 1rem;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}
body::before {
  content: "";
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  pointer-events: none;
  background: linear-gradient(120deg, rgba(255,255,255,0.09) 10%, rgba(255,255,255,0.01) 40%, rgba(255,255,255,0.11) 60%, rgba(255,255,255,0.02) 100%);
  z-index: 0;
  mix-blend-mode: lighten;
}
/* Dubbele body::before verwijderd */
h1 {
  text-align: center;
  margin: 0.7rem 0 0.7rem 0;
  background: linear-gradient(90deg, #fffbe6 0%, #ffe066 30%, #ffd700 70%, #bfa100 100%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  filter: drop-shadow(0 2px 12px #ffd70088) drop-shadow(0 1px 4px #bfa10044);
  text-shadow: 0 2px 16px #fff7, 0 1px 4px #bfa100;
  position: relative;
  font-weight: 900;
  letter-spacing: 1px;
}
h1::after {
  content: "";
  display: block;
  position: absolute;
  left: 30%; top: 20%;
  width: 40%; height: 35%;
  background: linear-gradient(120deg, rgba(255,255,255,0.32) 10%, rgba(255,255,255,0.01) 90%);
  pointer-events: none;
  border-radius: 40%;
  z-index: 1;
}
/* Dubbele h1-styling verwijderd */
.container {
  max-width: 420px;
  margin: 1rem auto 0.7rem auto;
  background: #111;
  padding: 1.1rem 1rem 1.1rem 1rem;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.18);
  box-sizing: border-box;
}
/* Dubbele .container-styling verwijderd */
    input, button, label, select, textarea {
      font-family: inherit;
      display: block;
      width: 100%;
      margin: 0.3rem 0;
      padding: 0.55rem;
      border: none;
      border-radius: 5px;
      font-size: 0.97rem;
    }
    input, select, textarea {
      background: linear-gradient(120deg, #232526 70%, #191919 100%);
      color: #ffd700;
      border: 1.5px solid #ffd70088;
      box-shadow: 0 1px 6px #ffd70022;
      outline: none;
      transition: border 0.18s, box-shadow 0.18s, background 0.18s;
    }
    /* Dubbele input/select/textarea styling verwijderd */
input:focus, select:focus, textarea:focus {
  border: 2px solid #ffd700;
  box-shadow: 0 0 10px #ffd70099, 0 2px 24px #191919cc;
  background: linear-gradient(120deg, #232526 40%, #ffd70022 100%);
  color: #fffbe6;
}

    button {
  background: linear-gradient(90deg, #fffbe6 0%, #ffe066 30%, #ffd700 70%, #bfa100 100%);
  color: #222;
  font-weight: bold;
  cursor: pointer;
  border: none;
  box-shadow: 0 3px 18px 0 #fff8, 0 3px 18px 0 #ffe06699, 0 1px 6px #bfa10055;
  text-shadow: 0 2px 10px #fff8, 0 1px 4px #bfa10099;
  transition: background 0.18s, box-shadow 0.18s, filter 0.18s, transform 0.12s;
  filter: brightness(1.13) drop-shadow(0 1px 8px #ffd70077);
  border-radius: 8px;
  position: relative;
  overflow: hidden;
}
button:after {
  content: "";
  display: block;
  position: absolute;
  left: 0; top: 0; right: 0; bottom: 0;
  background: linear-gradient(120deg, rgba(255,255,255,0.13) 10%, rgba(255,255,255,0.01) 90%);
  pointer-events: none;
  border-radius: 8px;
  z-index: 0;
}
button:hover, button:focus {
  background: linear-gradient(90deg, #fffbe6 0%, #ffd700 50%, #bfa100 100%);
  filter: brightness(1.18) drop-shadow(0 2px 10px #ffd70099);
  outline: none;
  transform: scale(1.03);
}

    #resultaat, #adminSpecificaties {
  background: linear-gradient(120deg, #232526 60%, #191919 100%);
  border: 2px solid #ffd70077;
  box-shadow: 0 2px 16px #ffd70033, 0 1px 8px #fff2;
  color: #fffbe6;
  font-size: 1.1rem;
  font-family: inherit;
  margin-top: 1.2rem;
  padding: 1.1rem 1rem;
  border-radius: 10px;
  word-break: break-word;
  transition: box-shadow 0.18s, border 0.18s;
}

    #datumContainer {
      display: none;
    }
    #flag {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      cursor: pointer;
    }
    #adminContainer {
  background: linear-gradient(135deg, #232526 60%, #ffd70044 100%);
  border: 2px solid #ffd700cc;
  box-shadow: 0 0 10px #ffd70044, 0 1px 8px #fff2;
  color: #ffd700;
  font-weight: bold;
  transition: box-shadow 0.18s, border 0.18s, background 0.18s;
}
#adminContainer:hover, #adminContainer:focus {
  box-shadow: 0 0 18px #ffd70099, 0 2px 16px #232526cc;
  background: linear-gradient(135deg, #ffd70033 0%, #232526 100%);
  color: #fffbe6;
  outline: none;
}

    /* Switch toggle styling */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 28px;
      margin-left: 10px;
      vertical-align: middle;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #888;
      transition: .4s;
      border-radius: 28px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    .switch input:checked + .slider {
      background-color: gold;
    }
    .switch input:checked + .slider:before {
      transform: translateX(22px);
    }
    /* Kosten-sectie container */
    .feature-section {
      background: #111;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.15);
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .feature-label {
      font-size: 1.1rem;
      font-weight: 500;
      color: #fff;
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
    }
    .feature-title {
      font-size: 1.15rem;
      font-weight: bold;
      color: gold;
      margin-bottom: 0.3rem;
    }
    .feature-desc {
      font-size: 0.98rem;
      color: #ccc;
    }
  .taxi-animation-container {
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
  overflow-y: visible;
  display: flex;
  justify-content: flex-start;
  align-items: flex-end;
  margin: 0;
  height: 60px;
  position: static;
  background: transparent;
  box-sizing: border-box;
  z-index: 10;
}
.taxi-svg {
  height: 60px;
  width: auto;
  display: block;
  margin: 0;
  overflow: visible;
  z-index: 10;
}
@media (min-width: 700px) {
  .taxi-animation-container {
    height: 80px;
  }
  .taxi-svg {
    height: 80px;
  }
}
@media (orientation: landscape) and (max-width: 900px) {
  .taxi-animation-container {
    height: 90px;
  }
}
.taxi-svg {
  animation: taxi-move-loop 7s linear infinite;
  will-change: transform;
  position: relative;
}
@keyframes taxi-move-loop {
  0%   { transform: translateX(-30vw); }
  100% { transform: translateX(100vw); }
}
@keyframes taxi-move {
  0%   { transform: translateX(-220px); }
  100% { transform: translateX(calc(100vw + 220px)); }
}
.smoke1 {
  animation: smoke1-move 2.8s linear infinite;
}
@keyframes smoke1-move {
  0% { opacity: 0.7; transform: translateX(0) scale(1,1); }
  10% { opacity: 0.6; transform: translateX(-7px) scale(1.1,1.1); }
  30% { opacity: 0.3; transform: translateX(-18px) scale(1.3,1.2); }
  50% { opacity: 0; transform: translateX(-28px) scale(1.5,1.3); }
  100% { opacity: 0; transform: translateX(-28px) scale(1.5,1.3); }
}
.smoke2 {
  animation: smoke2-move 2.8s linear infinite;
}
@keyframes smoke2-move {
  0% { opacity: 0.5; transform: translateX(0) scale(1,1); }
  15% { opacity: 0.4; transform: translateX(-10px) scale(1.1,1.1); }
  35% { opacity: 0.15; transform: translateX(-21px) scale(1.3,1.2); }
  55% { opacity: 0; transform: translateX(-31px) scale(1.5,1.3); }
  100% { opacity: 0; transform: translateX(-31px) scale(1.5,1.3); }
}
.adres-suggesties {
  position: absolute;
  background: #222;
  color: #fff;
  z-index: 10;
  width: 100%;
  max-width: 500px;
  border-radius: 0 0 10px 10px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  margin-top: -0.5rem;
  left: 0;
  right: 0;
  font-size: 1rem;
  display: none;
}
.adres-suggesties.active {
  display: block;
}
.adres-suggestie-item {
  background: none;
  color: #ffd700;
  transition: background 0.18s, color 0.18s;
  border-bottom: 1px solid #ffd70022;
  padding: 0.7rem 1rem;
  border-bottom: 1px solid #333;
  cursor: pointer;
  transition: background 0.2s;
}
.adres-suggestie-item:hover, .adres-suggestie-item:focus {
  background: linear-gradient(90deg, #ffd70022 0%, #232526 100%);
  color: #fffbe6;
  outline: none;
}
.adres-suggestie-item:last-child {
  border-bottom: none;
}
@media (max-width: 600px) {
  html, body {
    min-height: 100vh;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    overflow-x: hidden;
  }
  body {
    min-height: 100vh;
    background: #111;
    padding: 0.2rem 0 0.7rem 0;
    overflow-x: hidden;
  }
  .container {
    max-width: 100vw;
    width: 100vw;
    margin: 0.7rem 0 1.2rem 0;
    border-radius: 11px;
    padding: 1.1rem 1vw 1.5rem 1vw;
    box-sizing: border-box;
  }
  h1 {
    font-size: 2.5rem;
    margin: 1.2rem 0 1.3rem 0;
    letter-spacing: 1px;
    font-weight: 900;
    text-align: center;
    color: gold;
    text-shadow: 0 2px 16px rgba(255,215,0,0.08), 0 1px 6px rgba(0,0,0,0.2), 0 0px 30px rgba(255,215,0,0.08);
    filter: none;
  }
  input, select, textarea {
    font-size: 1.08rem;
    padding: 0.95rem 0.8rem;
    border-radius: 10px;
    margin-bottom: 0.7rem;
  }
  button {
    font-size: 1.08rem;
    padding: 1rem 0.8rem;
    border-radius: 10px;
    margin-bottom: 0.8rem;
    width: 100%;
    font-weight: bold;
    background: linear-gradient(90deg, #fffbe6 0%, #ffe066 30%, #ffd700 70%, #bfa100 100%);
    color: #222;
    border: none;
    box-shadow: 0 3px 14px rgba(255,215,0,0.09), 0 3px 14px rgba(255,215,0,0.09), 0 1px 4px rgba(0,0,0,0.1);
    text-shadow: 0 2px 8px rgba(255,215,0,0.08), 0 1px 2px rgba(0,0,0,0.1);
    transition: background 0.2s, box-shadow 0.2s, filter 0.2s;
    filter: brightness(1.08) drop-shadow(0 1px 6px rgba(255,215,0,0.08));
  }
  button:hover, button:focus {
    background: linear-gradient(90deg, #fffbe6 0%, #ffd700 50%, #bfa100 100%);
    filter: brightness(1.18) drop-shadow(0 2px 8px rgba(255,215,0,0.18));
    outline: none;
  }
  .taxi-animation-container {
    width: 100vw;
    min-width: 100vw;
    max-width: 100vw;
    height: 60px;
    margin-bottom: 1.1rem;
    overflow: hidden;
    box-sizing: border-box;
  }
  .adres-suggesties {
    font-size: 1.03rem;
    z-index: 1000;
    left: 0;
    right: 0;
    top: 100%;
    border-radius: 0 0 13px 13px;
    max-width: 100vw;
  }
}
  body {
    min-height: 100vh;
    background: #111;
    padding: 0.2rem 0 0.7rem 0;
    overflow-x: hidden;
  }
  .container {
    max-width: 100vw;
    width: 100vw;
    margin: 0.7rem 0.1rem;
    border-radius: 11px;
    padding: 1.1rem 0.15rem 1.8rem 0.15rem;
    box-sizing: border-box;
  }
  h1 {
    font-size: 1.55rem;
    margin: 1.2rem 0 1.2rem 0;
    text-align: center;
    color: gold;
    font-weight: 900;
    letter-spacing: 1px;
    text-shadow: 0 2px 12px rgba(255,215,0,0.08), 0 1px 4px rgba(0,0,0,0.1);
  }
  input, select, textarea {
    font-size: 1.12rem;
    padding: 1.05rem 0.9rem;
    border-radius: 10px;
    margin-bottom: 0.9rem;
  }
  button {
    font-size: 1.17rem;
    padding: 1.2rem 0.9rem;
    border-radius: 12px;
    margin-bottom: 1.1rem;
    width: 100%;
    font-weight: bold;
    background: linear-gradient(90deg, #fffbe6 0%, #ffe066 30%, #ffd700 70%, #bfa100 100%);
    color: #222;
    border: none;
    box-shadow: 0 3px 12px rgba(255,215,0,0.09);
  }
  .taxi-animation-container {
    height: 60px;
    margin-bottom: 1.2rem;
  }
  .adres-suggesties {
    font-size: 1.08rem;
    z-index: 1000;
    left: 0;
    right: 0;
    top: 100%;
    border-radius: 0 0 13px 13px;
    max-width: 100vw;
    
  }
  body {
    padding: 0.2rem;
    min-width: 0;
  }
  .container {
    max-width: 100vw;
    margin: 1rem 0.2rem;
    border-radius: 10px;
    padding: 1rem 0.5rem 1.3rem 0.5rem;
    box-shadow: 0 2px 18px rgba(0,0,0,0.24);
  }
  h1 {
    font-size: 1.35rem;
    margin: 0.5rem 0 0.7rem 0;
  }
  label, select, input, textarea, button {
    font-size: 1rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1rem;
    padding: 0.8rem 0.7rem;
    margin-bottom: 0.7rem;
    border-radius: 8px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.08rem;
    padding: 1rem 0.7rem;
    margin-bottom: 0.8rem;
    border-radius: 8px;
  }
  .taxi-animation-container {
    height: 42px;
    margin-bottom: 0.1rem;
  }
  .taxi-svg {
    width: 130px !important;
    height: 52px !important;
  }
  .adres-suggesties {
    max-width: 100vw;
    font-size: 0.97rem;
    left: 0;
    right: 0;
  }
  .adres-suggesties {
    max-width: 100vw;
    font-size: 0.97rem;
    left: 0;
    right: 0;
}
@media (min-width: 700px) and (max-width: 1200px) and (orientation: landscape) {
  body {
    padding: 0.5rem 0;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: linear-gradient(135deg, #232526 0%, #191919 50%, #232526 100%);
  }
  .taxi-animation-container {
    height: 90px;
    margin-bottom: 2.2rem;
    justify-content: center;
  }
  .taxi-svg {
    width: 320px !important;
    height: 128px !important;
  }
  .container {
    max-width: 850px;
    width: 98vw;
    margin: 2.2rem auto 2rem auto;
    border-radius: 22px;
    padding: 2.8rem 2.7rem 2.6rem 2.7rem;
    box-shadow: 0 16px 64px rgba(0,0,0,0.22), 0 2px 18px rgba(255,215,0,0.10);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3vw 2vw;
    align-items: flex-start;
    justify-content: center;
  }
  .container > div, .container > form, .container > section {
    min-width: 260px;
    margin-bottom: 1.5rem;
  }
  .container label, .container input, .container select, .container textarea, .container button {
    font-size: 1.17rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1.17rem;
    padding: 1.25rem 1.2rem;
    margin-bottom: 1.3rem;
    border-radius: 15px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.18rem;
    padding: 1.45rem 1.2rem;
    margin-bottom: 1.3rem;
    border-radius: 16px;
    box-shadow: 0 5px 20px rgba(255,215,0,0.10);
  }
  h1 {
    font-size: 1.55rem;
    margin: 1.2rem 0 1.7rem 0;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 1.13rem;
    left: 0;
    right: 0;
    border-radius: 0 0 16px 16px;
  }

  .taxi-svg {
    width: 260px !important;
    height: 104px !important;
  }
  .container {
    max-width: 750px;
    width: 96vw;
    margin: 1.5rem auto 1.2rem auto;
    border-radius: 18px;
    padding: 2.4rem 2.2rem 2.3rem 2.2rem;
    box-shadow: 0 12px 48px rgba(0,0,0,0.22), 0 2px 18px rgba(255,215,0,0.09);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: 2.5vw;
    align-items: flex-start;
    justify-content: space-between;
  }
  .container > div, .container > form, .container > section {
    flex: 1 1 44%;
    min-width: 260px;
    margin-bottom: 1.2rem;
  }
  .container label, .container input, .container select, .container textarea, .container button {
    font-size: 1.09rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1.09rem;
    padding: 1.1rem 1.1rem;
    margin-bottom: 1.1rem;
    border-radius: 12px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.13rem;
    padding: 1.25rem 1.1rem;
    margin-bottom: 1.1rem;
    border-radius: 14px;
    box-shadow: 0 3px 16px rgba(255,215,0,0.09);
  }
  h1 {
    font-size: 1.35rem;
    margin: 0.7rem 0 1.1rem 0;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 1.05rem;
    left: 0;
    right: 0;
    border-radius: 0 0 14px 14px;
  }
@media (max-width: 900px) and (orientation: landscape) {
  body {
    padding: 0.1rem;
    min-width: 0;
  }
  .container {
    max-width: 95vw;
    margin: 0.7rem auto;
    border-radius: 12px;
    padding: 0.7rem 1.2rem 1.1rem 1.2rem;
    box-shadow: 0 2px 18px rgba(0,0,0,0.22);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2vw;
  }
  .container > * {
    flex: 1 1 44%;
    min-width: 170px;
    margin-bottom: 0.7rem;
  }
  .taxi-animation-container {
    height: 56px;
    margin-bottom: 0.1rem;
  }
  .taxi-svg {
    width: 180px !important;
    height: 72px !important;
  }
  h1 {
  font-size: 2.2rem;
  margin: 1.2rem 0 1.3rem 0;
  letter-spacing: 1px;
  }
  label, select, input, textarea, button {
    font-size: 0.97rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 0.97rem;
    padding: 0.6rem 0.6rem;
    margin-bottom: 0.5rem;
    border-radius: 7px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1rem;
    padding: 0.8rem 0.5rem;
    margin-bottom: 0.6rem;
    border-radius: 7px;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 0.92rem;
    left: 0;
    right: 0;
  }
}
}

body {
  padding: 0.2rem;
  min-width: 0;
}
.container {
  max-width: 100vw;
  margin: 1rem 0.2rem;
  border-radius: 10px;
  padding: 1rem 0.5rem 1.3rem 0.5rem;
  box-shadow: 0 2px 18px rgba(0,0,0,0.24);
}
h1 {
  font-size: 1.35rem;
  margin: 0.5rem 0 0.7rem 0;
}
label, select, input, textarea, button {
  font-size: 1rem !important;
}
input[type="text"],
input[type="datetime-local"],
select, textarea {
  width: 100%;
  min-width: 0;
  max-width: 100%;
  font-size: 1rem;
  padding: 0.8rem 0.7rem;
  margin-bottom: 0.7rem;
  border-radius: 8px;
}
button {
  width: 100%;
  min-width: 0;
  font-size: 1.08rem;
  padding: 1rem 0.7rem;
  margin-bottom: 0.8rem;
  border-radius: 8px;
}
.taxi-animation-container {
  height: 42px;
  margin-bottom: 0.1rem;
}
.taxi-svg {
  width: 130px !important;
  height: 52px !important;
}
.adres-suggesties {
  max-width: 100vw;
  font-size: 0.97rem;
  left: 0;
  right: 0;
}
.adres-suggesties {
  max-width: 100vw;
  font-size: 0.97rem;
  left: 0;
  right: 0;
}
@media (min-width: 700px) and (max-width: 1200px) and (orientation: landscape) {
  body {
    padding: 0.5rem 0;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: linear-gradient(135deg, #232526 0%, #191919 50%, #232526 100%);
  }
  .taxi-animation-container {
    height: 90px;
    margin-bottom: 2.2rem;
    justify-content: center;
  }
  .taxi-svg {
    width: 320px !important;
    height: 128px !important;
  }
  .container {
    max-width: 850px;
    width: 98vw;
    margin: 2.2rem auto 2rem auto;
    border-radius: 22px;
    padding: 2.8rem 2.7rem 2.6rem 2.7rem;
    box-shadow: 0 16px 64px rgba(0,0,0,0.22), 0 2px 18px rgba(255,215,0,0.10);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3vw 2vw;
    align-items: flex-start;
    justify-content: center;
  }
  .container > div, .container > form, .container > section {
    min-width: 260px;
    margin-bottom: 1.5rem;
  }
  .container label, .container input, .container select, .container textarea, .container button {
    font-size: 1.17rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1.17rem;
    padding: 1.25rem 1.2rem;
    margin-bottom: 1.3rem;
    border-radius: 15px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.18rem;
    padding: 1.45rem 1.2rem;
    margin-bottom: 1.3rem;
    border-radius: 16px;
    box-shadow: 0 5px 20px rgba(255,215,0,0.10);
  }
  h1 {
    font-size: 1.55rem;
    margin: 1.2rem 0 1.7rem 0;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 1.13rem;
    left: 0;
    right: 0;
    border-radius: 0 0 16px 16px;
  }

  .taxi-svg {
    width: 260px !important;
    height: 104px !important;
  }
  .container {
    max-width: 750px;
    width: 96vw;
    margin: 1.5rem auto 1.2rem auto;
    border-radius: 18px;
    padding: 2.4rem 2.2rem 2.3rem 2.2rem;
    box-shadow: 0 12px 48px rgba(0,0,0,0.22), 0 2px 18px rgba(255,215,0,0.09);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: 2.5vw;
    align-items: flex-start;
    justify-content: space-between;
  }
  .container > div, .container > form, .container > section {
    flex: 1 1 44%;
    min-width: 260px;
    margin-bottom: 1.2rem;
  }
  .container label, .container input, .container select, .container textarea, .container button {
    font-size: 1.09rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1.09rem;
    padding: 1.1rem 1.1rem;
    margin-bottom: 1.1rem;
    border-radius: 12px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.13rem;
    padding: 1.25rem 1.1rem;
    margin-bottom: 1.1rem;
    border-radius: 14px;
    box-shadow: 0 3px 16px rgba(255,215,0,0.09);
  }
  h1 {
    font-size: 1.35rem;
    margin: 0.7rem 0 1.1rem 0;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 1.05rem;
    left: 0;
    right: 0;
    border-radius: 0 0 14px 14px;
  }
@media (max-width: 900px) and (orientation: landscape) {
  body {
    padding: 0.1rem;
    min-width: 0;
  }
  .container {
    max-width: 95vw;
    margin: 0.7rem auto;
    border-radius: 12px;
    padding: 0.7rem 1.2rem 1.1rem 1.2rem;
    box-shadow: 0 2px 18px rgba(0,0,0,0.22);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2vw;
  }
  .container > * {
    flex: 1 1 44%;
    min-width: 170px;
    margin-bottom: 0.7rem;
  }
  .taxi-animation-container {
    height: 56px;
    margin-bottom: 0.1rem;
  }
  .taxi-svg {
    width: 180px !important;
    height: 72px !important;
  }
  h1 {
  font-size: 2.2rem;
  margin: 1.2rem 0 1.3rem 0;
  letter-spacing: 1px;
  }
  label, select, input, textarea, button {
    font-size: 0.97rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 0.97rem;
    padding: 0.6rem 0.6rem;
    margin-bottom: 0.5rem;
    border-radius: 7px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1rem;
    padding: 0.8rem 0.5rem;
    margin-bottom: 0.6rem;
    border-radius: 7px;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 0.92rem;
    left: 0;
    right: 0;
  }
}
}

body {
  padding: 0.2rem;
  min-width: 0;
}
.container {
  max-width: 100vw;
  margin: 1rem 0.2rem;
  border-radius: 10px;
  padding: 1rem 0.5rem 1.3rem 0.5rem;
  box-shadow: 0 2px 18px rgba(0,0,0,0.24);
}
h1 {
  font-size: 1.35rem;
  margin: 0.5rem 0 0.7rem 0;
}
label, select, input, textarea, button {
  font-size: 1rem !important;
}
input[type="text"],
input[type="datetime-local"],
select, textarea {
  width: 100%;
  min-width: 0;
  max-width: 100%;
  font-size: 1rem;
  padding: 0.8rem 0.7rem;
  margin-bottom: 0.7rem;
  border-radius: 8px;
}
button {
  width: 100%;
  min-width: 0;
  font-size: 1.08rem;
  padding: 1rem 0.7rem;
  margin-bottom: 0.8rem;
  border-radius: 8px;
}
.taxi-animation-container {
  height: 42px;
  margin-bottom: 0.1rem;
}
.taxi-svg {
  width: 130px !important;
  height: 52px !important;
}
.adres-suggesties {
  max-width: 100vw;
  font-size: 0.97rem;
  left: 0;
  right: 0;
}
.adres-suggesties {
  max-width: 100vw;
  font-size: 0.97rem;
  left: 0;
  right: 0;
}
@media (min-width: 700px) and (max-width: 1200px) and (orientation: landscape) {
  body {
    padding: 0.5rem 0;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: linear-gradient(135deg, #232526 0%, #191919 50%, #232526 100%);
  }
  .taxi-animation-container {
    height: 90px;
    margin-bottom: 2.2rem;
    justify-content: center;
  }
  .taxi-svg {
    width: 320px !important;
    height: 128px !important;
  }
  .container {
    max-width: 850px;
    width: 98vw;
    margin: 2.2rem auto 2rem auto;
    border-radius: 22px;
    padding: 2.8rem 2.7rem 2.6rem 2.7rem;
    box-shadow: 0 16px 64px rgba(0,0,0,0.22), 0 2px 18px rgba(255,215,0,0.10);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3vw 2vw;
    align-items: flex-start;
    justify-content: center;
  }
  .container > div, .container > form, .container > section {
    min-width: 260px;
    margin-bottom: 1.5rem;
  }
  .container label, .container input, .container select, .container textarea, .container button {
    font-size: 1.17rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1.17rem;
    padding: 1.25rem 1.2rem;
    margin-bottom: 1.3rem;
    border-radius: 15px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.18rem;
    padding: 1.45rem 1.2rem;
    margin-bottom: 1.3rem;
    border-radius: 16px;
    box-shadow: 0 5px 20px rgba(255,215,0,0.10);
  }
  h1 {
    font-size: 1.55rem;
    margin: 1.2rem 0 1.7rem 0;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 1.13rem;
    left: 0;
    right: 0;
    border-radius: 0 0 16px 16px;
  }

  .taxi-svg {
    width: 260px !important;
    height: 104px !important;
  }
  .container {
    max-width: 750px;
    width: 96vw;
    margin: 1.5rem auto 1.2rem auto;
    border-radius: 18px;
    padding: 2.4rem 2.2rem 2.3rem 2.2rem;
    box-shadow: 0 12px 48px rgba(0,0,0,0.22), 0 2px 18px rgba(255,215,0,0.09);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: 2.5vw;
    align-items: flex-start;
    justify-content: space-between;
  }
  .container > div, .container > form, .container > section {
    flex: 1 1 44%;
    min-width: 260px;
    margin-bottom: 1.2rem;
  }
  .container label, .container input, .container select, .container textarea, .container button {
    font-size: 1.09rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 1.09rem;
    padding: 1.1rem 1.1rem;
    margin-bottom: 1.1rem;
    border-radius: 12px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1.13rem;
    padding: 1.25rem 1.1rem;
    margin-bottom: 1.1rem;
    border-radius: 14px;
    box-shadow: 0 3px 16px rgba(255,215,0,0.09);
  }
  h1 {
    font-size: 1.35rem;
    margin: 0.7rem 0 1.1rem 0;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 1.05rem;
    left: 0;
    right: 0;
    border-radius: 0 0 14px 14px;
  }
@media (max-width: 900px) and (orientation: landscape) {
  body {
    padding: 0.1rem;
    min-width: 0;
  }
  .container {
    max-width: 95vw;
    margin: 0.7rem auto;
    border-radius: 12px;
    padding: 0.7rem 1.2rem 1.1rem 1.2rem;
    box-shadow: 0 2px 18px rgba(0,0,0,0.22);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2vw;
  }
  .container > * {
    flex: 1 1 44%;
    min-width: 170px;
    margin-bottom: 0.7rem;
  }
  .taxi-animation-container {
    height: 56px;
    margin-bottom: 0.1rem;
  }
  .taxi-svg {
    width: 180px !important;
    height: 72px !important;
  }
  h1 {
  font-size: 2.2rem;
  margin: 1.2rem 0 1.3rem 0;
  letter-spacing: 1px;
  }
  label, select, input, textarea, button {
    font-size: 0.97rem !important;
  }
  input[type="text"],
  input[type="datetime-local"],
  select, textarea {
    width: 100%;
    min-width: 0;
    max-width: 100%;
    font-size: 0.97rem;
    padding: 0.6rem 0.6rem;
    margin-bottom: 0.5rem;
    border-radius: 7px;
  }
  button {
    width: 100%;
    min-width: 0;
    font-size: 1rem;
    padding: 0.8rem 0.5rem;
    margin-bottom: 0.6rem;
    border-radius: 7px;
  }
  .adres-suggesties {
    max-width: 95vw;
    font-size: 0.92rem;
    left: 0;
    right: 0;
  }
}
}

body {
  padding: 0.2rem;
  min-width: 0;
}
.container {
  max-width: 100vw;
  margin: 1rem 0.2rem;
  border-radius: 10px;
  padding: 1rem 0.5rem 1.3rem 0.5rem;
  box-shadow: 0 2px 18px rgba(0,0,0,0.24);
}
h1 {
  font-size: 1.35rem;
  margin: 0.5rem 0 0.7rem 0;
}
label, select, input, textarea, button {
  font-size: 1rem !important;
}
input[type="text"],
input[type="datetime-local"],
select, textarea {
  width: 100%;
  min-width: 0;
  max-width: 100%;
  font-size: 1rem;
  padding: 0.8rem 0.7rem;
  margin-bottom: 0.7rem;
  border-radius: 8px;
}
button {
  width: 100%;
  min-width: 0;
  font-size: 1.08rem;
  padding: 1rem 0.7rem;
  margin-bottom: 0.8rem;
  border-radius: 8px;
}
.taxi-animation-container {
  height: 42px;
  margin-bottom: 0.1rem;
}
.taxi-svg {
  width: 130px !important;
  height: 52px !important;
}
.adres-suggesties {
  max-width: 100vw;
  font-size: 0.97rem;
  left: 0;
  right: 0;
}
.adres-suggesties {
  max-width: 100vw;
  font-size: 0.97rem;
  left: 0;
  right: 0;
}
</style>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
</head>

<body>

<div style="position: fixed; top: 16px; left: 16px; z-index: 100;">
  <a href="admin.html" id="adminContainer" title="Beheerder" style="background:#111; border-radius:50%; width:38px; height:38px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px #ffd70066; font-size:1.7rem; color:gold; border:2px solid gold; text-decoration:none;">ğŸ”’</a>
</div>

<!-- Language selector dropdown -->
<div id="langSelector" style="position: fixed; top: 16px; right: 16px; z-index: 100;">
  <button id="langToggle" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">ğŸŒ</button>
  <div id="langMenu" style="display:none; position:absolute; top:2.5rem; right:0; background:#fff; padding:0.5rem; border-radius:4px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <img src="https://flagcdn.com/w40/nl.png" onclick="switchLanguage('nl')" title="Nederlands" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/ma.png" onclick="switchLanguage('ar')" title="Marokko" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/tr.png" onclick="switchLanguage('tr')" title="TÃ¼rkÃ§e" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/fr.png" onclick="switchLanguage('fr')" title="FranÃ§ais" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/it.png" onclick="switchLanguage('it')" title="Italiano" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/es.png" onclick="switchLanguage('es')" title="EspaÃ±ol" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/de.png" onclick="switchLanguage('de')" title="Deutsch" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/pl.png" onclick="switchLanguage('pl')" title="Polski" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/gb.png" onclick="switchLanguage('en')" title="English" style="width:30px;cursor:pointer;margin:0.2rem;">
    <img src="https://flagcdn.com/w40/pt.png" onclick="switchLanguage('pt')" title="PortuguÃªs" style="width:30px;cursor:pointer;margin:0.2rem;">
  </div>
</div>

<h1>FA TAXI Service</h1>
<h2 style="text-align:center; margin-top:-0.7rem; color:gold; font-size:1.1rem; letter-spacing:1px;">TAXI 4 Personen</h2>
<div class="taxi-animation-container">
  <svg class="taxi-svg" viewBox="0 0 220 88" width="220" height="88">
    <!-- Rookpluimpjes -->
    <ellipse class="smoke smoke1" cx="28" cy="55" rx="14" ry="6" fill="#bbb" opacity="0.7"/>
    <ellipse class="smoke smoke2" cx="12" cy="62" rx="10" ry="4" fill="#ccc" opacity="0.5"/>
    <!-- Taxi body -->
    <rect x="30" y="30" width="60" height="20" rx="7" fill="#FFD600" stroke="#333" stroke-width="2"/>
    <!-- Taxi cabin -->
    <rect x="55" y="20" width="25" height="15" rx="5" fill="#FFD600" stroke="#333" stroke-width="2"/>
    <!-- Ramen -->
    <rect x="58" y="23" width="8" height="9" rx="2" fill="#B3E5FC" stroke="#333" stroke-width="1"/>
    <rect x="68" y="23" width="10" height="9" rx="2" fill="#B3E5FC" stroke="#333" stroke-width="1"/>
    <!-- Taxi-bord -->
    <rect x="67" y="16" width="12" height="7" rx="2" fill="#fff" stroke="#333" stroke-width="1"/>
    <text x="73" y="22" font-size="6" font-family="Arial" fill="#FFD700" text-anchor="middle" font-weight="bold">TAXI</text>
    <!-- Wielen -->
    <ellipse cx="40" cy="52" rx="7" ry="7" fill="#222"/>
    <ellipse cx="80" cy="52" rx="7" ry="7" fill="#222"/>
    <ellipse cx="40" cy="52" rx="3" ry="3" fill="#888"/>
    <ellipse cx="80" cy="52" rx="3" ry="3" fill="#888"/>
    <!-- Koplampen -->
    <ellipse cx="32" cy="40" rx="2" ry="4" fill="#fffde7" opacity="0.7"/>
    <ellipse cx="90" cy="40" rx="2" ry="4" fill="#fffde7" opacity="0.7"/>
  </svg>
</div>
<!-- Hoekknoppen -->
  <label for="ophaaladres" id="labelOphaal">ğŸ“ OPHAAL ADRES ğŸ“ </label>
  <div class="input-wrapper" style="position:relative; width:100%;">
    <input 
      type="text" 
      id="ophaaladres" 
      placeholder="Bijv. Stationsplein 1, Amsterdam" 
      autocomplete="off" 
      oninput="zoekAdresSuggesties(this, 'ophaaladres-suggesties')" 
      aria-label="Ophaaladres" 
      required 
    />
    <div id="ophaaladres-suggesties" class="adres-suggesties" style="position:absolute; top:100%; left:0; width:100%; z-index:10;"></div>
    <button type="button" onclick="gebruikLocatie()" id="locatieBtn">ğŸ“ Mijn locatie</button>
  </div>

  <!-- Tussenstop knop en velden -->
  <button type="button" id="tussenstopBtn" onclick="toonTussenstopVeld()" style="margin-bottom:0.5rem;">â• Tussenstop toevoegen</button>
  <div id="tussenstopContainer" style="display:none; margin-bottom:0.5rem;"></div>

  <label for="afzetadres" id="labelAfzet">ğŸ“ AFZET ADRES ğŸ“</label>
  <div class="input-wrapper" style="position:relative; width:100%;">
    <input 
      type="text" 
      id="afzetadres" 
      placeholder="Bijv. Damrak 50, Amsterdam" 
      autocomplete="off" 
      oninput="zoekAdresSuggesties(this, 'afzetadres-suggesties')" 
      aria-label="Afzetadres" 
      required 
    />
    <div id="afzetadres-suggesties" class="adres-suggesties" style="position:absolute; top:100%; left:0; width:100%; z-index:10;"></div>
  </div>

  <!-- Kaart met route -->
  <div id="kaart-container" style="background: #181818ee; border-radius: 18px; box-shadow: 0 6px 32px #000a, 0 1.5px 8px #ffd70055; margin: 1.2em 0 1.6em 0; padding: 1.1em 1em 1.3em 1em; max-width: 100vw;">
    <div style="font-weight: 700; color: gold; font-size: 1.13rem; margin-bottom: 0.6em; letter-spacing: 0.03em; text-shadow: 0 2px 8px #ffd70044;">ğŸš— Route op de kaart</div>
    <div id="map" style="height: 330px; width: 100%; border-radius: 13px; overflow: hidden; box-shadow: 0 2px 12px #0005;"></div>
  </div>

  <button type="button" onclick="toggleDatum()" id="toggleDatumBtn" aria-controls="datumContainer" aria-expanded="false">ğŸ“… Reserveren? â‚¬17.50,- ğŸ“…</button>

  <div id="datumContainer">
    <label for="tijdstip" id="labelTijdstip">ğŸ•’ Gewenst tijdstip ğŸ•’</label>
    <input type="datetime-local" id="tijdstip" aria-label="Gewenst tijdstip" />
  </div>

  <label for="betaalmethode" id="labelBetaal">ğŸ’³ Kies een betaalmethode ğŸ’³</label>
  <select id="betaalmethode" aria-label="Betaalmethode" required>
    <option value="IDEAL Online-Betaal-Link">ğŸŒ IDEAL Online-Betaal-Link</option>
    <option value="Tikkie">ğŸ”— Tikkie</option>
    <option value="Pin bij chauffeur">ğŸ’³ Pin bij chauffeur</option>
    <option value="Contant">ğŸ’¶ Contant</option>
  </select>

  <label for="kortingscode" id="labelKorting">ğŸ’° Kortingscode ğŸ’°</label>
  <input 
    type="text" 
    id="kortingscode" 
    placeholder="Voer uw kortingscode in" 
    aria-label="Kortingscode" 
  />

  <label for="opmerkingen" id="labelOpmerkingen">âœï¸ Opmerkingen âœï¸</label>
  <textarea 
    id="opmerkingen" 
    placeholder="Bijvoorbeeld: helpen met bagage, bijzonderheden, etc." 
    rows="2"
    style="resize:vertical; background:#222; color:#fff; border-radius:5px; width:100%; margin:0.5rem 0; padding:0.7rem;"
  ></textarea>

  <button type="button" onclick="toggleHuisdier()" id="huisdierBtn">ğŸ¶ Huisdieren â‚¬5,- ğŸ¶</button>
  <input type="hidden" id="huisdieren" value="0">

  <button type="button" onclick="toggleSpoed()" id="spoedBtn">ğŸš€ Spoedrit â‚¬10 ğŸš€</button>

  <button onclick="toggleAkkoord()" id="akkoordBtn">ğŸš¨ Annuleringskosten â‚¬10,- ğŸš¨</button>
  <input type="hidden" id="akkoord" value="0">

  <button onclick="berekenRit()" id="btnBereken">ğŸš– Bereken ritprijs ğŸš–</button>

  <div id="resultaat"></div>


  <button id="idealPayBtn" style="width:100%; margin:0.5rem 0; display:none; align-items:center; justify-content:center; gap:0.5em;" onclick="window.startIdealPay()">
  <span style="height:1.5em; display:inline-block; vertical-align:middle; margin-right:0.3em; background:#fff; border-radius:4px; box-shadow:0 1px 4px #0001;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 32" width="28" height="18" style="display:block;">
      <rect width="50" height="32" rx="8" fill="#fff"/>
      <path d="M8 4h15a11 11 0 1 1 0 24H8z" fill="#c06"/>
      <path d="M13.2 8.8v14.4h2.9c2.5 0 4.1-1.5 4.1-3.7 0-1.5-0.8-2.6-2.2-3.1 1.1-0.4 1.8-1.3 1.8-2.6 0-2-1.4-3-3.8-3h-2.8zm2.1 2h0.7c1.1 0 1.7 0.5 1.7 1.5 0 1-0.6 1.5-1.7 1.5h-0.7zm0 5.1h0.9c1.2 0 1.9 0.6 1.9 1.6 0 1-0.7 1.6-1.9 1.6h-0.9z" fill="#fff"/>
      <text x="32" y="22" font-family="Arial, Helvetica, sans-serif" font-size="10" fill="#000">iDEAL</text>
    </svg>
  </span>
  Direct betalen via iDEAL
</button>

  <div id="adminSpecificaties" style="display:none;"></div>

  <div id="bevestigContainer" style="display:none;">
    <a id="whatsappKnop" href="https://wa.me/message/WPXHSY3TEYVPA1" target="_blank">
      <button disabled aria-disabled="true" tabindex="-1" style="pointer-events:none;">ğŸ“© Bevestig & Verstuur naar WhatsApp ğŸ“©</button>
    </a>
  </div>
</div>

<!-- Zet ALLE scripts vlak voor </body> -->
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script>
// Kaart object globaal zodat we hem kunnen hergebruiken
let map, routeLayer, startMarker, endMarker;

// Initieer kaart direct bij laden op Nederland
window.addEventListener('DOMContentLoaded', () => {
  if (!map) {
    map = L.map('map').setView([52.2, 5.3], 7); // Nederland
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
      maxZoom: 18,
    }).addTo(map);
  }
  // Probeer automatisch de locatie op te halen
  probeerAutoLocatie();
});

// Probeer automatisch de locatie op te halen en vul het ophaaladres in
async function probeerAutoLocatie() {
  if (!navigator.geolocation) return;
  try {
    navigator.geolocation.getCurrentPosition(async pos => {
      try {
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        // Zoom en marker op kaart
        if (map) {
          map.setView([lat, lon], 16);
          if (window.autoLocMarker) map.removeLayer(window.autoLocMarker);
          window.autoLocMarker = L.marker([lat, lon], {title: 'Uw locatie', icon: L.icon({iconUrl:'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-blue.png', shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]})}).addTo(map).bindPopup('Uw locatie').openPopup();
        }
        // Haal adres op via OpenCage
        const url = `https://api.tomtom.com/search/2/reverseGeocode/${lat},${lon}.json?key=fLy6nvAxRi3ACx2G69Q9fHabDwHz80fe`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.results && data.results[0]) {
          const ophaalInput = document.getElementById("ophaaladres");
          if (ophaalInput) ophaalInput.value = data.results[0].formatted;
        }
      } catch (err) {
        // geen alert, fallback naar handmatige knop
      }
    }, err => {
      // geen alert, fallback naar handmatige knop
    });
  } catch (err) {
    // geen alert, fallback naar handmatige knop
  }
}


// Subtiele foutmelding helper
function showSubtleError(message, targetId) {
  let target = document.getElementById(targetId) || document.getElementById('ritprijs') || document.body;
  let errDiv = document.createElement('div');
  errDiv.innerText = message;
  errDiv.style = 'background:#ffd700;color:#111;padding:6px 12px;border-radius:7px;margin:8px 0;text-align:center;font-size:1.02rem;box-shadow:0 2px 10px #ffd70044;z-index:9999;';
  errDiv.className = 'subtle-error-msg';
  target.parentNode.insertBefore(errDiv, target);
  setTimeout(()=>{ errDiv.remove(); }, 4000);
}

// Functie om de afstand van een route te berekenen in kilometers
function calculateRouteDistance(coords) {
  if (!coords || coords.length < 2) return 0;
  
  // Haversine formule om afstand tussen twee punten te berekenen
  function haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Aarde radius in km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }
  
  // Bereken totale afstand door alle segmenten bij elkaar op te tellen
  let totalDistance = 0;
  for (let i = 0; i < coords.length - 1; i++) {
    totalDistance += haversineDistance(
      coords[i][0], coords[i][1],
      coords[i+1][0], coords[i+1][1]
    );
  }
  
  return totalDistance;
}

async function showRouteOnMap(ophaaladres, afzetadres) {
  // Haal coÃ¶rdinaten op van ophaaladres, tussenstops en afzetadres
  const adressen = [ophaaladres];
  for (let i = 1; i <= 3; i++) {
    const ts = document.getElementById(`tussenstop${i}`);
    if (ts && ts.value && ts.value.trim()) {
      adressen.push(ts.value.trim());
    }
  }
  adressen.push(afzetadres);
  // Haal alle coÃ¶rdinaten op (async)
  let coordsArr = [];
  for (let adres of adressen) {
    const coord = await getCoordinates(adres);
    if (coord) {
      coordsArr.push(coord);
    } else {
      // Sla fout adres over, maar ga door met de rest
      continue;
    }
  }
  if (coordsArr.length < 2) {
    showSubtleError('Te weinig geldige adressen voor een route.', 'map');
    return;
  }
  // Initieer kaart indien nog niet gedaan
  if (!map) {
    map = L.map('map').setView([coordsArr[0][1], coordsArr[0][0]], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
      maxZoom: 18,
    }).addTo(map);
  } else {
    map.setView([coordsArr[0][1], coordsArr[0][0]], 11);
    if (routeLayer) map.removeLayer(routeLayer);
    if (startMarker) map.removeLayer(startMarker);
    if (endMarker) map.removeLayer(endMarker);
  }
  // OpenRouteService API call (multi-waypoint)
  const apiKey = '';
  const url = 'https://api.openrouteservice.org/v2/directions/driving-car/geojson';
  const body = {
    coordinates: coordsArr.map(c => [c[0], c[1]])
  };
  let data;
  try {
    const res = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': apiKey
      },
      body: JSON.stringify(body)
    });
    data = await res.json();
    if (!data.features || !data.features[0]) {
      showSubtleError('Route niet gevonden.', 'map');
      return;
    }
  } catch (err) {
    showSubtleError('Kan route niet ophalen (netwerkfout).', 'map');
    return;
  }
  const coords = data.features[0].geometry.coordinates.map(c => [c[1], c[0]]);
  // Teken route met verbeterde zichtbaarheid
  routeLayer = L.polyline(coords, {color: 'gold', weight: 6, opacity: 0.9}).addTo(map);
  
  // Bereken optimale padding op basis van schermgrootte
  const mapElement = document.getElementById('map');
  const isSmallScreen = window.innerWidth < 768;
  const padding = isSmallScreen ? [30, 30] : [80, 80];
  
  // Bereken optimale zoom op basis van routelengte
  const routeDistance = calculateRouteDistance(coords);
  let maxZoom = 15; // Standaard max zoom
  
  // Pas zoom aan op basis van afstand
  if (routeDistance < 5) maxZoom = 14; // Korte routes (< 5 km)
  else if (routeDistance < 20) maxZoom = 13; // Middellange routes (5-20 km)
  else if (routeDistance < 50) maxZoom = 12; // Langere routes (20-50 km)
  else maxZoom = 11; // Zeer lange routes (> 50 km)
  
  // Fit de kaart perfect rond de route
  map.fitBounds(routeLayer.getBounds(), {
    padding: padding,
    maxZoom: maxZoom,
    animate: true,
    duration: 0.5 // Soepele animatie
  });
  
  // Plaats markers voor start, tussenstops en einde
  startMarker = L.marker([coordsArr[0][1], coordsArr[0][0]], {
    title: 'Ophaaladres',
    icon: L.divIcon({
      className: 'custom-div-icon',
      html: '<div style="background-color:#4CAF50;width:12px;height:12px;border-radius:50%;border:2px solid white;"></div>',
      iconSize: [15, 15],
      iconAnchor: [7, 7]
    })
  }).addTo(map);
  
  // Voeg markers toe voor tussenstops
  if (coordsArr.length > 2) {
    for (let i = 1; i < coordsArr.length - 1; i++) {
      L.marker([coordsArr[i][1], coordsArr[i][0]], {
        title: `Tussenstop ${i}`,
        icon: L.divIcon({
          className: 'custom-div-icon',
          html: '<div style="background-color:#FFC107;width:10px;height:10px;border-radius:50%;border:2px solid white;"></div>',
          iconSize: [15, 15],
          iconAnchor: [7, 7]
        })
      }).addTo(map);
    }
  }
  
  // Eindmarker
  endMarker = L.marker([coordsArr[coordsArr.length-1][1], coordsArr[coordsArr.length-1][0]], {
    title: 'Afzetadres',
    icon: L.divIcon({
      className: 'custom-div-icon',
      html: '<div style="background-color:#F44336;width:12px;height:12px;border-radius:50%;border:2px solid white;"></div>',
      iconSize: [15, 15],
      iconAnchor: [7, 7]
    })
  }).addTo(map);
  
  // Zorg dat de kaart zich aanpast bij schermformaat wijzigingen
  window.addEventListener('resize', () => {
    if (routeLayer) {
      const newPadding = window.innerWidth < 768 ? [30, 30] : [80, 80];
      map.invalidateSize();
      map.fitBounds(routeLayer.getBounds(), {padding: newPadding, maxZoom: maxZoom});
    }
  });
}



</script>
<script>
// --- FA Taxi Boeking | Modern, robuust & foutloos script ---

// --- Tussenstop functionaliteit ---
let tussenstopAantal = 0;
const MAX_TUSSENSTOPS = 3;

// Zorg dat verwijderen van een tussenstop ook autoBereken triggert
window.verwijderTussenstop = function(idx) {
  const el = document.getElementById(`tussenstop${idx}`);
  if (el && el.parentNode) {
    el.parentNode.remove();
    tussenstopAantal--;
    if (typeof autoBereken === 'function') autoBereken();
    // Heractiveer knop als nodig
    if (tussenstopAantal < MAX_TUSSENSTOPS) {
      const btn = document.getElementById('tussenstopBtn');
      if (btn) {
        btn.disabled = false;
        btn.innerText = 'â• Tussenstop toevoegen';
      }
    }
  }
};

function toonTussenstopVeld() {
  const container = document.getElementById('tussenstopContainer');
  if (tussenstopAantal < MAX_TUSSENSTOPS) {
    tussenstopAantal++;
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'tussenstop-input';
    input.placeholder = `Tussenstop ${tussenstopAantal} (adres)`;
    input.setAttribute('autocomplete', 'off');
    input.style.marginBottom = '0.3rem';
    input.oninput = function() { zoekAdresSuggesties(this, `tussenstop-suggesties-${tussenstopAantal}`); };
    input.setAttribute('aria-label', `Tussenstop ${tussenstopAantal}`);
    input.id = `tussenstop${tussenstopAantal}`;
    // Suggestie container
    const suggestDiv = document.createElement('div');
    suggestDiv.id = `tussenstop-suggesties-${tussenstopAantal}`;
    suggestDiv.className = 'adres-suggesties';
    suggestDiv.style.cssText = 'position:absolute; top:100%; left:0; width:100%; z-index:10;';
    // Wrapper
    const wrapper = document.createElement('div');
    wrapper.className = 'input-wrapper';
    wrapper.style.position = 'relative';
    wrapper.appendChild(input);
    wrapper.appendChild(suggestDiv);
    container.appendChild(wrapper);
    container.style.display = '';
    if (tussenstopAantal === MAX_TUSSENSTOPS) {
      document.getElementById('tussenstopBtn').disabled = true;
      document.getElementById('tussenstopBtn').innerText = 'Maximaal 3 tussenstops bereikt';
    }
  }
  // Na toevoegen van een tussenstop: prijs automatisch herberekenen
  if (typeof autoBereken === 'function') {
    autoBereken();
  }
}

// --- Prijsberekening uitbreiden voor tussenstops ---
const orig_berekenRitprijs = window.berekenRitprijs || function() { return 0; };

function berekenRitprijs(afstand, duur, weer) {
  try {
    // Roep de oorspronkelijke functie aan
    const basisprijs = orig_berekenRitprijs(afstand, duur, weer) || 0;
    
    // Voeg toeslagen toe voor tussenstops
    const tussenstops = document.querySelectorAll('.tussenstop').length;
    const toeslagPerStop = 5; // â‚¬5 toeslag per tussenstop
    
    return basisprijs + (tussenstops * toeslagPerStop);
  } catch (error) {
    console.error('Fout bij het berekenen van de ritprijs:', error);
    return 0; // Geef een standaardwaarde terug bij fouten
  }
}

// --- Draft saving met timestamp voor oningevulde gegevens ---
(function() {
  'use strict';
  
  const fields = ['ophaaladres', 'afzetadres', 'tijdstip', 'betaalmethode', 'kortingscode', 'huisdieren', 'opmerkingen'];
  const DRAFT_KEY = 'taxi_booking_draft';
  const DRAFT_TIMEOUT = 24 * 60 * 60 * 1000; // 24 uur

  // Sla het huidige formulier op
  function saveDraft() {
    try {
      const draft = { timestamp: Date.now(), data: {} };
      fields.forEach(field => {
        const el = document.getElementById(field);
        if (el) draft.data[field] = el.value || '';
      });
      localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
      return true;
    } catch (error) {
      console.error('Fout bij opslaan concept:', error);
      return false;
    }
  }
  
  // Functie om HTML attributen te escapen
  function escapeHtmlAttr(str) {
    if (!str) return '';
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;')
      .replace(/\r/g, ' ')
      .replace(/\n/g, ' ');
  }
  
  // Functie om adressuggesties te verwerken
  function processAddressSuggestions(data, suggestieDiv, inputElem, suggestieDivId) {
    try {
      if (!data || !data.results || !Array.isArray(data.results)) {
        console.error('Ongeldige data ontvangen voor adressuggesties');
        return;
      }
      
      const shownResults = data.results
        .map(r => ({
          formatted: r.address?.freeformAddress
        }))
        .filter(r => r.formatted);
      
      console.log('Suggestie Resultaten:', shownResults);
      
      if (suggestieDiv) {
        suggestieDiv.innerHTML = shownResults.map(r => {
          const safeValue = escapeHtmlAttr(r.formatted);
          const inputIdSafe = escapeHtmlAttr(inputElem.id);
          const suggestieDivIdSafe = escapeHtmlAttr(suggestieDivId);
          return `<div class="adres-suggestie-item" onclick="kiesAdresSuggestie('${inputIdSafe}', '${suggestieDivIdSafe}', '${safeValue}')">${r.formatted}</div>`;
        }).join('');
        suggestieDiv.classList.add('active');
      }
    } catch (error) {
      console.error('Fout bij verwerken adressuggesties:', error);
      if (suggestieDiv) {
        suggestieDiv.innerHTML = '';
        suggestieDiv.classList.remove('active');
      }
    }
  }
  
  // Maak functies beschikbaar in het globale bereik
  window.saveDraft = saveDraft;
  window.escapeHtmlAttr = escapeHtmlAttr;
  window.processAddressSuggestions = processAddressSuggestions;
  
  // Initialisatiecode hier indien nodig
  
  // Functie om een adressuggestie te selecteren
  window.kiesAdresSuggestie = function(inputId, suggestieDivId, waarde) {
    try {
      const inputElement = document.getElementById(inputId);
      const suggestieDiv = document.getElementById(suggestieDivId);
      
      if (inputElement) inputElement.value = waarde || '';
      if (suggestieDiv) {
        suggestieDiv.innerHTML = '';
        suggestieDiv.classList.remove('active');
      }
    } catch (error) {
      console.error('Fout in kiesAdresSuggestie:', error);
    }
  };
  
  // Event listeners voor adresvelden
  document.addEventListener('DOMContentLoaded', function() {
    const ophaaladres = document.getElementById('ophaaladres');
    const afzetadres = document.getElementById('afzetadres');
    
    if (ophaaladres) {
      ophaaladres.addEventListener('input', function() {
        zoekAdresSuggesties(this, 'ophaaladres-suggesties');
      });
    }
    
    if (afzetadres) {
      afzetadres.addEventListener('input', function() {
        zoekAdresSuggesties(this, 'afzetadres-suggesties');
      });
    }
  });
  
  // Sluit suggesties als er buiten wordt geklikt
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.adres-suggestie-item') && !e.target.matches('input[type="text"]')) {
      document.querySelectorAll('.adres-suggesties').forEach(div => {
        div.innerHTML = '';
        div.classList.remove('active');
      });
    }
  });
  
  // Event listener voor het sluiten van suggesties bij klik buiten het veld
  if (typeof window !== 'undefined') {
    window.addEventListener('click', e => {
      ['ophaaladres-suggesties', 'afzetadres-suggesties'].forEach(id => {
        const box = document.getElementById(id);
        if (box && !box.contains(e.target) && e.target.id !== id.replace('-suggesties','')) {
          box.innerHTML = '';
          box.classList.remove('active');
        }
      });
    });
  }
  
  // Functie om adressuggesties op te halen
  window.zoekAdresSuggesties = async function(inputElem, suggestieDivId) {
    if (!inputElem || !inputElem.value || inputElem.value.length < 3) {
      const div = document.getElementById(suggestieDivId);
      if (div) {
        div.innerHTML = '';
        div.classList.remove('active');
      }
      return;
    }
    
    const suggestieDiv = document.getElementById(suggestieDivId);
    
    try {
      // Toon een laadindicator
      if (suggestieDiv) {
        suggestieDiv.innerHTML = '<div class="loading">Bezig met zoeken...</div>';
        suggestieDiv.classList.add('active');
      }
      
      // Haal suggesties op van de TomTom API
      const response = await fetch(`https://api.tomtom.com/search/2/search/${encodeURIComponent(inputElem.value)}.json?key=YOUR_TOMTOM_API_KEY&countrySet=NL&limit=5`);
      const data = await response.json();
      
      // Verwerk de resultaten
      processAddressSuggestions(data, suggestieDiv, inputElem, suggestieDivId);
    } catch (error) {
      console.error('Fout bij ophalen adressuggesties:', error);
      if (suggestieDiv) {
        suggestieDiv.innerHTML = '<div class="error">Fout bij ophalen suggesties. Probeer het opnieuw.</div>';
        suggestieDiv.classList.add('active');
      }
    }
  };
  
  // Event listeners voor adresvelden toevoegen zodra de DOM geladen is
  document.addEventListener('DOMContentLoaded', () => {
    const ophaaladres = document.getElementById('ophaaladres');
    const afzetadres = document.getElementById('afzetadres');
    
    if (ophaaladres) {
      ophaaladres.addEventListener('input', function() {
        zoekAdresSuggesties(this, 'ophaaladres-suggesties');
      });
    }
    
    if (afzetadres) {
      afzetadres.addEventListener('input', function() {
        zoekAdresSuggesties(this, 'afzetadres-suggesties');
      });
    }
  });
  
  // Maak functies beschikbaar in het globale bereik
  window.toggleSpoed = function() {
    const spoedBtn = document.getElementById('spoedToggle');
    const spoedInput = document.getElementById('spoed');
    
    if (spoedInput && spoedBtn) {
      if (spoedInput.value === 'nee') {
        spoedInput.value = 'ja';
        spoedBtn.textContent = 'âš¡ Spoed: Ja';
        spoedBtn.classList.add('active');
      } else {
        spoedInput.value = 'nee';
        spoedBtn.textContent = 'âš¡ Spoed: Nee';
        spoedBtn.classList.remove('active');
      }
    }
  };
  
  // Maak de toggleAkkoord functie beschikbaar in het globale bereik
  window.toggleAkkoord = function() {
    const akkoordBtn = document.getElementById('akkoordToggle');
    const akkoordInput = document.getElementById('akkoord');
    
    if (akkoordInput && akkoordBtn) {
      if (akkoordInput.value === 'nee') {
        akkoordInput.value = 'ja';
        akkoordBtn.textContent = 'âœ… Akkoord: Ja';
        akkoordBtn.classList.add('active');
      } else {
        akkoordInput.value = 'nee';
        akkoordBtn.textContent = 'âœ… Akkoord: Nee';
        akkoordBtn.classList.remove('active');
      }
    } else {
      console.error('Kon akkoordknop of input niet vinden');
    }
  };
  
  // Sluit de IIFE af
})();

// De toggleAkkoord functie is nu beschikbaar via het window object

// Functie om de rit te berekenen
window.berekenRit = function() {
  try {
    // Roep de bestaande berekenRit functie aan
    if (typeof window.berekenRit === 'function') {
      window.berekenRit();
    } else {
      throw new Error('berekenRit functie niet gevonden');
    }
  } catch (error) {
    console.error('Fout bij het berekenen van de rit:', error);
    const errorMessage = error.message || 'Er is een onverwachte fout opgetreden';
    alert(`Kan rit niet berekenen: ${errorMessage}. Neem contact op met ondersteuning.`);
  }
};

// Initialiseer de applicatie
document.addEventListener('DOMContentLoaded', function() {
  // Voer hier eventuele initialisatiecode uit
});
</script>

<script>
'use strict';
// Vertalingen en initiÃ«le setup
const initApp = () => {
  // Taalinstellingen ophalen
  const lang = new URLSearchParams(location.search).get('lang') || 'nl';
  console.log('Geselecteerde taal:', lang);
  
  // Vertaalbron
  const dict = {
    nl: {
      h1: 'FA TAXI Service',
      h2: 'TAXI 4 Personen',
      tussenstopBtn: 'â• Tussenstop toevoegen',
      labelTijdstip: 'ğŸ•’ Gewenst tijdstip ğŸ•’',
      labelBetaal: 'ğŸ’³ Kies een betaalmethode ğŸ’³',
      labelKorting: 'ğŸ’° Kortingscode ğŸ’°',
      labelOpmerkingen: 'âœï¸ Opmerkingen âœï¸',
      idealPayBtn: 'Direct betalen via iDEAL',
      textareaPH: 'Bijvoorbeeld: helpen met bagage, bijzonderheden, etc.',
      adminSpecificaties: 'Admin specificaties',
      selectIdeal: 'ğŸŒ IDEAL Online-Betaal-Link',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Pin bij chauffeur',
      selectCash: 'ğŸ’¶ Contant',
      ophaal: 'ğŸ“ OPHAAL ADRES ğŸ“',
      afzet: 'ğŸ“ AFZET ADRES ğŸ“',
      reserveren: 'ğŸ“… Reserveren? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Huisdieren â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Spoedrit â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Annuleringskosten â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Bereken ritprijs ğŸš–',
      ph: 'Bijv. Stationsplein 1, Amsterdam',
      dh: 'Bijv. Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ Mijn locatie'
    },
    en: {
      h1: 'FA TAXI Service',
      h2: 'TAXI 4 Persons',
      tussenstopBtn: 'â• Add stopover',
      labelTijdstip: 'ğŸ•’ Desired time ğŸ•’',
      labelBetaal: 'ğŸ’³ Choose a payment method ğŸ’³',
      labelKorting: 'ğŸ’° Discount code ğŸ’°',
      labelOpmerkingen: 'âœï¸ Comments âœï¸',
      idealPayBtn: 'Pay directly via iDEAL',
      textareaPH: 'For example: help with luggage, special requests, etc.',
      adminSpecificaties: 'Admin specifications',
      selectIdeal: 'ğŸŒ IDEAL Online Payment Link',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Card at driver',
      selectCash: 'ğŸ’¶ Cash',
      ophaal: 'ğŸ“ Pickup Address ğŸ“',
      afzet: 'ğŸ“ Drop-off Address ğŸ“',
      reserveren: 'ğŸ“… Reserve? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Pets â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Rush â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Cancel fee â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Calculate Fare ğŸš–',
      ph: 'e.g. Central Station 1, Amsterdam',
      dh: 'e.g. Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ My location'
    },
    es: {
      h1: 'FA TAXI Servicio',
      h2: 'TAXI 4 Personas',
      tussenstopBtn: 'â• AÃ±adir parada',
      labelTijdstip: 'ğŸ•’ Hora deseada ğŸ•’',
      labelBetaal: 'ğŸ’³ Elija un mÃ©todo de pago ğŸ’³',
      labelKorting: 'ğŸ’° CÃ³digo de descuento ğŸ’°',
      labelOpmerkingen: 'âœï¸ Comentarios âœï¸',
      idealPayBtn: 'Pagar directamente con iDEAL',
      textareaPH: 'Por ejemplo: ayuda con equipaje, detalles especiales, etc.',
      adminSpecificaties: 'Especificaciones admin',
      selectIdeal: 'ğŸŒ Enlace de pago IDEAL',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Tarjeta al conductor',
      selectCash: 'ğŸ’¶ Efectivo',
      ophaal: 'ğŸ“ DirecciÃ³n de recogida ğŸ“',
      afzet: 'ğŸ“ DirecciÃ³n de entrega ğŸ“',
      reserveren: 'ğŸ“… Reservar? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Mascotas â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Servicio urgente â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Cargo de cancelaciÃ³n â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Calcular tarifa ğŸš–',
      ph: 'p.ej. Stationsplein 1, Ãmsterdam',
      dh: 'p.ej. Damrak 50, Ãmsterdam',
      locatieBtn: 'ğŸ“ Mi ubicaciÃ³n'
    },
    ar: {
      h1: 'Ø®Ø¯Ù…Ø© ØªØ§ÙƒØ³ÙŠ FA',
      h2: 'ØªØ§ÙƒØ³ÙŠ Ù¤ Ø£Ø´Ø®Ø§Øµ',
      tussenstopBtn: 'â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø·Ø©',
      labelTijdstip: 'ğŸ•’ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ğŸ•’',
      labelBetaal: 'ğŸ’³ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ ğŸ’³',
      labelKorting: 'ğŸ’° Ø±Ù…Ø² Ø§Ù„Ø®ØµÙ… ğŸ’°',
      labelOpmerkingen: 'âœï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª âœï¸',
      idealPayBtn: 'Ø§Ù„Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± iDEAL',
      textareaPH: 'Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø£Ù…ØªØ¹Ø©ØŒ ØªÙØ§ØµÙŠÙ„ Ø®Ø§ØµØ©ØŒ Ø¥Ù„Ø®.',
      adminSpecificaties: 'Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ø´Ø±Ù',
      selectIdeal: 'ğŸŒ Ø±Ø§Ø¨Ø· Ø¯ÙØ¹ iDEAL',
      selectTikkie: 'ğŸ”— ØªÙŠÙƒÙŠ',
      selectPin: 'ğŸ’³ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚',
      selectCash: 'ğŸ’¶ Ù†Ù‚Ø¯Ø§Ù‹',
      ophaal: 'ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ ğŸ“',
      afzet: 'ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØµÙˆÙ„ ğŸ“',
      reserveren: 'ğŸ“… Ø­Ø¬Ø²ØŸ â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø£Ù„ÙŠÙØ© â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Ø®Ø¯Ù…Ø© Ø¹Ø§Ø¬Ù„Ø© â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Ø§Ø­Ø³Ø¨ Ø§Ù„Ø£Ø¬Ø±Ø© ğŸš–',
      ph: 'Ù…Ø«Ø§Ù„: Stationsplein 1, Amsterdam',
      dh: 'Ù…Ø«Ø§Ù„: Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ'
    },
    pt: {
      h1: 'ServiÃ§o FA TAXI',
      h2: 'TÃXI 4 Pessoas',
      tussenstopBtn: 'â• Adicionar parada',
      labelTijdstip: 'ğŸ•’ HorÃ¡rio desejado ğŸ•’',
      labelBetaal: 'ğŸ’³ Escolha um mÃ©todo de pagamento ğŸ’³',
      labelKorting: 'ğŸ’° CÃ³digo de desconto ğŸ’°',
      labelOpmerkingen: 'âœï¸ ComentÃ¡rios âœï¸',
      idealPayBtn: 'Pagar diretamente via iDEAL',
      textareaPH: 'Por exemplo: ajuda com bagagem, detalhes especiais, etc.',
      adminSpecificaties: 'EspecificaÃ§Ãµes admin',
      selectIdeal: 'ğŸŒ Link de pagamento IDEAL',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ CartÃ£o com motorista',
      selectCash: 'ğŸ’¶ Dinheiro',
      ophaal: 'ğŸ“ EndereÃ§o de partida ğŸ“',
      afzet: 'ğŸ“ EndereÃ§o de chegada ğŸ“',
      reserveren: 'ğŸ“… Reservar? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Animais â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ ServiÃ§o urgente â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Taxa de cancelamento â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Calcular tarifa ğŸš–',
      ph: 'Ex: Stationsplein 1, AmsterdÃ£',
      dh: 'Ex: Damrak 50, AmsterdÃ£',
      locatieBtn: 'ğŸ“ Minha localizaÃ§Ã£o'
    },
    tr: {
      h1: 'FA TAKSÄ° Servisi',
      h2: 'TAKSÄ° 4 KiÅŸi',
      tussenstopBtn: 'â• Ara durak ekle',
      labelTijdstip: 'ğŸ•’ Ä°stenen zaman ğŸ•’',
      labelBetaal: 'ğŸ’³ Ã–deme yÃ¶ntemi seÃ§in ğŸ’³',
      labelKorting: 'ğŸ’° Ä°ndirim kodu ğŸ’°',
      labelOpmerkingen: 'âœï¸ Yorumlar âœï¸',
      idealPayBtn: 'iDEAL ile hemen Ã¶de',
      textareaPH: 'Ã–rneÄŸin: bagaj yardÄ±mÄ±, Ã¶zel notlar, vb.',
      adminSpecificaties: 'YÃ¶netici Ã¶zellikleri',
      selectIdeal: 'ğŸŒ IDEAL Online Ã–deme Linki',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ ÅofÃ¶rde kart',
      selectCash: 'ğŸ’¶ Nakit',
      ophaal: 'ğŸ“ AlÄ±ÅŸ NoktasÄ± ğŸ“',
      afzet: 'ğŸ“ BÄ±rakma NoktasÄ± ğŸ“',
      reserveren: 'ğŸ“… Rezervasyon? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Evcil Hayvan â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Acele Hizmet â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Ä°ptal Ãœcreti â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Ãœcret Hesapla ğŸš–',
      ph: 'Ã–rn: Stationsplein 1, Amsterdam',
      dh: 'Ã–rn: Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ Konumum'
    },
    fr: {
      h1: 'Service FA TAXI',
      h2: 'TAXI 4 Personnes',
      tussenstopBtn: 'â• Ajouter une Ã©tape',
      labelTijdstip: 'ğŸ•’ Heure souhaitÃ©e ğŸ•’',
      labelBetaal: 'ğŸ’³ Choisissez un mode de paiement ğŸ’³',
      labelKorting: 'ğŸ’° Code promo ğŸ’°',
      labelOpmerkingen: 'âœï¸ Commentaires âœï¸',
      idealPayBtn: 'Payer directement via iDEAL',
      textareaPH: 'Par exemple : aide pour les bagages, remarques, etc.',
      adminSpecificaties: 'SpÃ©cifications admin',
      selectIdeal: 'ğŸŒ Lien de paiement IDEAL',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Carte au chauffeur',
      selectCash: 'ğŸ’¶ EspÃ¨ces',
      ophaal: 'ğŸ“ Adresse de dÃ©part ğŸ“',
      afzet: 'ğŸ“ Adresse dâ€™arrivÃ©e ğŸ“',
      reserveren: 'ğŸ“… RÃ©server? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Animaux â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Service urgent â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Frais dâ€™annulation â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Calculer Tarif ğŸš–',
      ph: 'Ex: Stationsplein 1, Amsterdam',
      dh: 'Ex: Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ Ma position'
    },
    it: {
      h1: 'Servizio FA TAXI',
      h2: 'TAXI 4 Persone',
      tussenstopBtn: 'â• Aggiungi fermata',
      labelTijdstip: 'ğŸ•’ Orario desiderato ğŸ•’',
      labelBetaal: 'ğŸ’³ Scegli un metodo di pagamento ğŸ’³',
      labelKorting: 'ğŸ’° Codice sconto ğŸ’°',
      labelOpmerkingen: 'âœï¸ Commenti âœï¸',
      idealPayBtn: 'Paga direttamente con iDEAL',
      textareaPH: 'Ad esempio: aiuto con i bagagli, dettagli particolari, ecc.',
      adminSpecificaties: 'Specifiche admin',
      selectIdeal: 'ğŸŒ Link pagamento IDEAL',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Carta al conducente',
      selectCash: 'ğŸ’¶ Contanti',
      ophaal: 'ğŸ“ Indirizzo di partenza ğŸ“',
      afzet: 'ğŸ“ Indirizzo di arrivo ğŸ“',
      reserveren: 'ğŸ“… Prenota? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Animali â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Servizio Urgente â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ Tariffa cancellazione â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Calcola Tariffa ğŸš–',
      ph: 'Es: Stationsplein 1, Amsterdam',
      dh: 'Es: Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ La mia posizione'
    },
    de: {
      h1: 'FA TAXI Service',
      h2: 'TAXI 4 Personen',
      tussenstopBtn: 'â• Zwischenstopp hinzufÃ¼gen',
      labelTijdstip: 'ğŸ•’ GewÃ¼nschte Zeit ğŸ•’',
      labelBetaal: 'ğŸ’³ Zahlungsmethode wÃ¤hlen ğŸ’³',
      labelKorting: 'ğŸ’° Rabattcode ğŸ’°',
      labelOpmerkingen: 'âœï¸ Bemerkungen âœï¸',
      idealPayBtn: 'Direkt mit iDEAL bezahlen',
      textareaPH: 'Zum Beispiel: Hilfe mit GepÃ¤ck, Besonderheiten, etc.',
      adminSpecificaties: 'Admin-Spezifikationen',
      selectIdeal: 'ğŸŒ IDEAL Online-Zahlungslink',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Karte beim Fahrer',
      selectCash: 'ğŸ’¶ Barzahlung',
      ophaal: 'ğŸ“ Abholadresse ğŸ“',
      afzet: 'ğŸ“ Zieladresse ğŸ“',
      reserveren: 'ğŸ“… Reservieren? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ Haustiere â‚¬5,- ğŸ¶',
      spoed: 'ğŸš€ Eilfahrt â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ StornogebÃ¼hr â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Fahrtpreis berechnen ğŸš–',
      ph: 'z.B. Stationsplein 1, Amsterdam',
      dh: 'z.B. Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ Mein Standort'
    },
    pl: {
      h1: 'FA TAXI UsÅ‚uga',
      h2: 'TAXI 4 Osoby',
      tussenstopBtn: 'â• Dodaj przystanek',
      labelTijdstip: 'ğŸ•’ PoÅ¼Ä…dany czas ğŸ•’',
      labelBetaal: 'ğŸ’³ Wybierz metodÄ™ pÅ‚atnoÅ›ci ğŸ’³',
      labelKorting: 'ğŸ’° Kod rabatowy ğŸ’°',
      labelOpmerkingen: 'âœï¸ Uwagi âœï¸',
      idealPayBtn: 'ZapÅ‚aÄ‡ bezpoÅ›rednio przez iDEAL',
      textareaPH: 'Na przykÅ‚ad: pomoc z bagaÅ¼em, szczegÃ³Å‚y, itp.',
      adminSpecificaties: 'Specyfikacje admina',
      selectIdeal: 'ğŸŒ IDEAL Link pÅ‚atnoÅ›ci',
      selectTikkie: 'ğŸ”— Tikkie',
      selectPin: 'ğŸ’³ Karta u kierowcy',
      selectCash: 'ğŸ’¶ GotÃ³wka',
      ophaal: 'ğŸ“ Adres odbioru ğŸ“',
      afzet: 'ğŸ“ Adres dostawy ğŸ“',
      reserveren: 'ğŸ“… RezerwowaÄ‡? â‚¬17,50 ğŸ“…',
      huisdieren: 'ğŸ¶ ZwierzÄ™ta ğŸ¶ 5â‚¬',
      spoed: 'ğŸš€ Pilna usÅ‚uga â‚¬10 ğŸš€',
      akkoord: 'ğŸš¨ OpÅ‚ata za anulowanie â‚¬10,- ğŸš¨',
      bereken: 'ğŸš– Oblicz cenÄ™ ğŸš–',
      ph: 'np. Stationsplein 1, Amsterdam',
      dh: 'np. Damrak 50, Amsterdam',
      locatieBtn: 'ğŸ“ Moja lokalizacja'
    }
  };

  console.log('Index translation object for', lang, dict[lang]);
  const t = dict[lang] || dict.nl;
  console.log('Index using translation:', t);
  document.getElementById('labelOphaal').innerText = t.ophaal;
  document.getElementById('labelAfzet').innerText = t.afzet;
  document.getElementById('toggleDatumBtn').innerText = t.reserveren;
  document.getElementById('huisdierBtn').innerText = t.huisdieren;
  document.getElementById('spoedBtn').innerText = t.spoed;
  document.getElementById('akkoordBtn').innerText = t.akkoord;
  document.getElementById('btnBereken').innerText = t.bereken;
  document.getElementById('ophaaladres').placeholder = t.ph;
  document.getElementById('afzetadres').placeholder = t.dh;
  document.getElementById('locatieBtn').innerText = t.locatieBtn;

  // Extra vertalingen voor volledige pagina
  if(document.getElementById('h1Title')) document.getElementById('h1Title').innerText = t.h1 || dict.nl.h1;
  if(document.getElementById('h2Subtitle')) document.getElementById('h2Subtitle').innerText = t.h2 || dict.nl.h2;
  if(document.getElementById('tussenstopBtn')) document.getElementById('tussenstopBtn').innerText = t.tussenstopBtn || dict.nl.tussenstopBtn;
  if(document.getElementById('labelTijdstip')) document.getElementById('labelTijdstip').innerText = t.labelTijdstip || dict.nl.labelTijdstip;
  if(document.getElementById('labelBetaal')) document.getElementById('labelBetaal').innerText = t.labelBetaal || dict.nl.labelBetaal;
  // Update labels en placeholders
  const updateElement = (id, property, value) => {
    const el = document.getElementById(id);
    if (el && value) el[property] = value;
  };

  updateElement('labelKorting', 'innerText', t.labelKorting || dict.nl.labelKorting);
  updateElement('labelOpmerkingen', 'innerText', t.labelOpmerkingen || dict.nl.labelOpmerkingen);
  updateElement('opmerkingen', 'placeholder', t.textareaPH || dict.nl.textareaPH);
  
  const idealBtn = document.getElementById('idealPayBtn');
  if (idealBtn && idealBtn.lastChild) {
    idealBtn.lastChild.textContent = ' ' + (t.idealPayBtn || dict.nl.idealPayBtn);
  }
  
  updateElement('adminSpecificaties', 'innerText', t.adminSpecificaties || dict.nl.adminSpecificaties);
  
  // Update betaalmethode opties
  const betaalSelect = document.getElementById('betaalmethode');
  if (betaalSelect && betaalSelect.options.length >= 4) {
    const options = [
      t.selectIdeal || dict.nl.selectIdeal,
      t.selectTikkie || dict.nl.selectTikkie,
      t.selectPin || dict.nl.selectPin,
      t.selectCash || dict.nl.selectCash
    ];
    
    options.forEach((text, index) => {
      if (betaalSelect.options[index]) {
        betaalSelect.options[index].text = text;
      }
    });
  }
});
</script>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const toggle = document.getElementById('langToggle');
  const menu = document.getElementById('langMenu');
  if (!toggle || !menu) return;
  toggle.addEventListener('click', e => {
    e.stopPropagation();
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  });
  menu.addEventListener('click', e => e.stopPropagation());
  document.addEventListener('click', () => { menu.style.display = 'none'; });
});
</script>

<script>
  // Maak een globale functie zodat deze direct aangeroepen kan worden
  window.startIdealPay = async function() {
    // Check eerst of we een geldige prijs hebben
    if (!window.lastPrice || isNaN(window.lastPrice) || parseFloat(window.lastPrice) <= 0) {
      // Probeer de prijs uit het prijsveld te halen als fallback
      const prijsEl = document.getElementById('ritprijs');
      if (prijsEl && prijsEl.innerText) {
        const prijsText = prijsEl.innerText.replace(/[^0-9,.]/g, '').replace(',', '.');
        const prijs = parseFloat(prijsText);
        if (!isNaN(prijs) && prijs > 0) {
          window.lastPrice = prijs;
        } else {
          showSubtleError('Bereken eerst de ritprijs', 'ritprijs');
          return;
        }
      } else {
        showSubtleError('Bereken eerst de ritprijs', 'ritprijs');
        return;
      }
    }
    
    // Toon loader tijdens betaalproces
    const betaalBtn = document.querySelector('button[onclick="startIdealPay()"]');
    const origText = betaalBtn ? betaalBtn.innerText : '';
    if (betaalBtn) {
      betaalBtn.innerHTML = '<span class="loader" style="display:inline-block;width:16px;height:16px;border:2px solid #232526;border-top:2px solid #ffd700;border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-right:6px;"></span>Betaling starten...';
      betaalBtn.disabled = true;
    }
    
    const description = `Taxi rit ${window.currentRitID || 'FA' + Date.now()}`;
    try {
      const res = await fetch('https://yolo-n9xa.onrender.com/api/pay', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: window.lastPrice, description })
      });
      const data = await res.json();
      if (data.checkoutUrl) window.location.href = data.checkoutUrl;
      else throw new Error(data.error || 'Geen checkoutURL');
    } catch (err) {
      showSubtleError('Betaling kon niet worden gestart.', 'ritprijs');
      // Herstel knop
      if (betaalBtn) {
        betaalBtn.innerHTML = origText;
        betaalBtn.disabled = false;
      }
    }
  };
</script>
<script>
// OVERRIDE BEREKENRIT NA ALLES ANDERS!
window.addEventListener('DOMContentLoaded', function() {
  if (typeof berekenRit === 'function') {
    const origBerekenRit = berekenRit;
    berekenRit = async function() {
      await origBerekenRit.apply(this, arguments);
      const ophalen = document.getElementById('ophaaladres').value;
      const afzetten = document.getElementById('afzetadres').value;
      if (ophalen && afzetten) {
        showRouteOnMap(ophalen, afzetten);
      }
    };
  }
});
</script>
<script>
// Functie om de huidige locatie te gebruiken
function gebruikLocatie() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        // Reverse geocoding om het adres op te halen
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=nl`)
          .then(response => response.json())
          .then(data => {
            const adres = data.display_name || `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            document.getElementById('ophaaladres').value = adres;
            // Activeer eventuele validatie of berekeningen
            if (typeof autoBereken === 'function') autoBereken();
          })
          .catch(error => {
            console.error('Fout bij ophalen adres:', error);
            alert('Kon locatie niet omzetten naar adres. Probeer het handmatig in te vullen.');
          });
      },
      function(error) {
        console.error('Geolocatie fout:', error);
        alert('Kon uw locatie niet ophalen. Controleer of u toestemming heeft gegeven voor locatie-toegang.');
      }
    );
  } else {
    alert('Geolocatie wordt niet ondersteund door uw browser.');
  }
}

// --- Automatische prijsberekening bij wijzigen invoervelden ---
(function() {
  // Loader helpers
  function showPriceLoader() {
    let prijsEl = document.getElementById('ritprijs') || document.querySelector('[data-prijs]');
    if (prijsEl) {
      prijsEl.dataset.origText = prijsEl.innerText;
      prijsEl.innerHTML = '<span class="loader" style="display:inline-block;width:18px;height:18px;border:2px solid #ffd700;border-top:2px solid #232526;border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-right:6px;"></span>Bezig met berekenen...';
    }
  }
  function hidePriceLoader() {
    let prijsEl = document.getElementById('ritprijs') || document.querySelector('[data-prijs]');
    if (prijsEl && prijsEl.dataset.origText) {
      prijsEl.innerText = prijsEl.dataset.origText;
      delete prijsEl.dataset.origText;
    }
  }
  // Debounce met async/await support
  function debounceAsync(fn, ms = 350) {
    let timer;
    return function(...args) {
      return new Promise((resolve) => {
        clearTimeout(timer);
        timer = setTimeout(async () => {
          showPriceLoader();
          try {
            const result = await fn.apply(this, args);
            resolve(result);
          } catch (err) {
            // Toon subtiele melding in prijsveld
            showSubtleError('Prijs niet beschikbaar', 'ritprijs');
            resolve(null);
          } finally {
            hidePriceLoader();
          }
        }, ms);
      });
    };
  }
  
  // Globale variabele om dubbele berekeningen te voorkomen
  let isCalculating = false;
  
  const autoBereken = debounceAsync(async () => {
    if (isCalculating) return null;
    isCalculating = true;
    try {
      if (typeof berekenRit === 'function') {
        await berekenRit();
        // Zorg dat lastPrice altijd beschikbaar is
        if (window.lastPrice === undefined || window.lastPrice === null) {
          const prijsEl = document.getElementById('ritprijs');
          if (prijsEl && prijsEl.innerText) {
            const prijsText = prijsEl.innerText.replace(/[^0-9,.]/g, '').replace(',', '.');
            const prijs = parseFloat(prijsText);
            if (!isNaN(prijs)) window.lastPrice = prijs;
          }
        }
      }
      return window.lastPrice;
    } finally {
      isCalculating = false;
    }
  });
  const autoFields = [
    'ophaaladres', 'afzetadres', 'tijdstip', 'betaalmethode', 'kortingscode', 'opmerkingen',
    'huisdieren', 'spoed', 'akkoord'
  ];
  window.addEventListener('DOMContentLoaded', function() {
    autoFields.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('input', autoBereken);
        el.addEventListener('change', autoBereken);
      }
    });
    // Dynamisch toegevoegde tussenstops
    // Vertraagde verwerking voor tussenstops
    let tussenstopTimer = null;
    document.addEventListener('input', function(e) {
      if (e.target && e.target.classList && e.target.classList.contains('tussenstop-input')) {
        // Verwijder eerst alle oude loaders
        document.querySelectorAll('.tussenstop-loader').forEach(l => l.remove());
        
        // Alleen herberekenen als het een volledig adres lijkt
        const val = e.target.value.trim();
        
        // Check of het een volledig adres lijkt (straatnaam + huisnummer + evt. plaatsnaam)
        // Patroon: tekst + spatie + cijfer (evt. gevolgd door letter) + evt. komma en plaatsnaam
        const isCompleteAddress = (
          val.length > 8 && // Minimaal 8 tekens
          /\s\d+/.test(val) && // Bevat spatie gevolgd door cijfer (huisnummer)
          /^[^\d]+\s\d+[a-zA-Z]*(,\s*[^\d,]+)?$/.test(val) // Straat + nummer + evt. plaats
        );
        
        if (isCompleteAddress) {
          // Loader tonen
          const loader = document.createElement('span');
          loader.className = 'tussenstop-loader';
          loader.style = 'display:inline-block;width:16px;height:16px;border:2px solid #ffd700;border-top:2px solid #232526;border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-left:6px;position:absolute;right:10px;top:50%;transform:translateY(-50%);';
          e.target.parentNode.style.position = 'relative';
          e.target.parentNode.appendChild(loader);
          
          // Vertraag de berekening om te voorkomen dat we bij elke toetsaanslag herberekenen
          clearTimeout(tussenstopTimer);
          tussenstopTimer = setTimeout(() => {
            autoBereken().finally(() => {
              // Verwijder alle loaders na berekening
              document.querySelectorAll('.tussenstop-loader').forEach(l => l.remove());
            });
          }, 2000); // Wacht 2 seconden na laatste toetsaanslag voor een betrouwbare berekening
        }
      }
    });
  });
  // CSS voor loader animatie
  const style = document.createElement('style');
  style.innerHTML = `@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}`;
  document.head.appendChild(style);
})();
</script>
<script>
window.startIdealPay = async function() {
  try {
    // Haal prijs en omschrijving uit het formulier
    const prijsEl = document.getElementById('ritprijs');
    const prijs = prijsEl ? prijsEl.innerText.replace(/[^0-9,.]/g, '').replace(',', '.') : '17.50';
    const amount = prijs || '17.50'; // fallback
    const description = 'Taxi rit via klant.html';
    
    // Toon laadindicator
    const button = document.getElementById('betaalKnop');
    const originalText = button ? button.innerHTML : '';
    if (button) button.innerHTML = 'Bezig met betalen...';
    
    try {
      // Dynamisch API base kiezen
      const apiBase = (window.location.hostname === 'fataxi.github.io') ? 'https://yolo-n9xa.onrender.com' : '';
      const response = await fetch(`${apiBase}/api/pay`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount, description })
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const data = await response.json();
      if (data.checkoutUrl) {
        window.location.href = data.checkoutUrl;
      } else {
        throw new Error('Geen checkout URL ontvangen');
      }
    } catch (error) {
      console.error('Fout bij betaling:', error);
      alert('Betaling starten mislukt. Probeer het later opnieuw.');
    } finally {
      // Herstel de originele knoptekst
      if (button) button.innerHTML = originalText;
    }
  } catch (err) {
    console.error('Er ging iets mis bij het starten van de betaling:', err);
    alert('Er ging iets mis bij het starten van de betaling. Probeer het opnieuw.');
  }
};
</script>
  <!-- Voeg hier eventueel analytics of andere scripts toe -->
</body>
</html>
